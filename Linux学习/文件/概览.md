# 硬链接和软链接

## 硬链接

```
$ ln P1 P2
```

用来创建一个新的硬链接，即由路径 P1 表示标识的文件创建一个路径名为 P2 的硬链接

硬链接有两方面的限制：

* 不允许用户给目录创建硬链接。因为这可能把目录树变成环形图
* 只有在同一文件系统中的文件之间才可以创建硬链接

## 软链接

```
ln -s P1 P2
```

创建一个路径名为 P2 的新软链接，P2 指向路径 P1，当这个命令执行的时，文件系统抽出 P2 的目录部分，并在那个目录下创建一个名为 P2的符号类型的新项。

# 文件类型

* 普通文件
* 目录
* 符号链接
* 面向块的设备文件
* 面向字符的设备文件
* 管道和命名管道
* 套接字

# 文件描述符与索引节点

文件系统用索引标识文件，必须提供以下属性

* 文件类型
* 与文件相关的硬链接个数
* 以字节为单位的文件长度
* 设备标识符（即包含文件的设备的标识符）
* 在文件系统中标识文件的索引节点号
* 文件拥有者的 UID
* 文件的用户组 ID
* 几个时间戳，表示索引节点状态的改变时间、最后访问时间及最后修改时间
* 访问权限和文件模式

## 文件权限和文件模式

文件用户类型

* 作为文件的所有者的用户
* 同组用户，不包括所有者
* 所有剩下的用户（其他）

有三种类型的访问权限：读、写、执行。因此文件组合有 9 种不同的二进制来标记，还有三种附加标记如下：

* suid

  * 进程执行一个文件时通常保持进程拥有者的 UID。然而，如果设置了可执行文件 suid 的标志位，进程就获得了该文件拥有者的 UID
* sgid

  * 进程执行一个文件时通常保持进程组的用户组 ID。然而，如果设置了可执行文件 sgid 的标志位，进程就获得了该文件用户组的 ID
* sticky

  * 当程序执行结束后，依然将它保留在内存

## 打开/访问文件

```cpp
fd = open(path, flag, mode);
newoffset = lseek(fd, offset, whence);
nread = read(fd, buf, count);
res = close(fd);
res = rename(oldpath, newpath);
res = unlink(pathname);
```
path: 文件路径
flag: 打开方式（读，写，追加，是否应当创建一个不存在的文件）
mode: 指定新创建的文件的访问模式
whence: 指定文件指针新位置的计算方式，可以是从文件头，文件尾，当前文件指针
nread: 实际所读取的字节数

